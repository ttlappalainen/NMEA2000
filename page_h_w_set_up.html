<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="NMEA2000 C++ library" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Library to handle NMEA 2000 Communication written in C++." />
<meta property="og:url" content="https://github.com/ttlappalainen/NMEA2000" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="NMEA2000 C++ library" />
<meta name="twitter:description" content="Library to handle NMEA 2000 Communication written in C++." />
<!-- END twitter metadata -->
<title>NMEA2000 Library: Setting Up Hardware Environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo_sqare1.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-custom-alternative.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/ttlappalainen/NMEA2000" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_s.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NMEA2000 Library
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Library to handle NMEA 2000 Communication written in C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('page_h_w_set_up.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Setting Up Hardware Environment </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md126">Some terminology</a></li>
<li class="level1"><a href="#secTRecHW">Recommended hardware</a><ul><li class="level2"><a href="#subCANcontr">CAN controller</a></li>
<li class="level2"><a href="#subCANtrans">CAN Transceiver</a><ul><li class="level3"><a href="#subsubRecTra">Recommended transceiver</a></li>
<li class="level3"><a href="#subsubUnIso">Unisolated transceiver</a><ul><li class="level4"><a href="#autotoc_md127">Microchip MCP2562</a></li>
</ul>
</li>
<li class="level3"><a href="#subsubIso">Isolated transceiver</a><ul><li class="level4"><a href="#autotoc_md128">TI ISO1050 Isolated CAN Transceiver</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#secSchem">Schematics sample</a><ul><li class="level2"><a href="#subFeedPwr">Feeding power from NMEA2000</a></li>
<li class="level2"><a href="#subTEunIso">Teensy 3.2, simple unisolated</a></li>
<li class="level2"><a href="#subTEiso">Teensy 3.2, simple isolated</a></li>
<li class="level2"><a href="#subTEperf">More protection for tranceiver</a></li>
<li class="level2"><a href="#subFeedPwe">Feed isolated power from NMEA2000</a></li>
</ul>
</li>
<li class="level1"><a href="#secTesting">Testing devices</a></li>
<li class="level1"><a href="#secCommErr">Most common hardware errors</a></li>
<li class="level1"><a href="#secNMEA2000bus">NMEA2000 bus</a><ul><li class="level2"><a href="#subTopology">Bus topology</a></li>
<li class="level2"><a href="#subConnetor">Bus connectors</a></li>
<li class="level2"><a href="#subCable">Bus cables</a></li>
<li class="level2"><a href="#secFailure">Prepare for failures</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p >Setting up a basic Hardware environment.</p>
<p ><a class="anchor" id="md_3_hwSetup"></a></p>
<p >This manual is meant for beginners who starts to build their own devices. There is general information, links and hints about building NMEA2000 network on <a class="el" href="page_h_w_set_up.html#secNMEA2000bus">NMEA2000 bus</a>.</p>
<p >Since I published NMEA2000 library I had several times guided beginners with hardware problems. In this manual I try to give collected information for recommended and required hardware for making NMEA2000 devices and how to connect them to NMEA2000 bus.</p>
<dl class="section warning"><dt>Warning</dt><dd>You connect your hardware always with your own risk. I wrote this document in order to help you connecting your own hardware to the NMEA2000 bus. I do not take any responsibility of any errors in the document or any possible damages caused to your devices.</dd></dl>
<h1><a class="anchor" id="autotoc_md126"></a>
Some terminology</h1>
<ul>
<li>Board. Development board like Teensy 3.2, ESP32, Raspberry Pi, Arduino Due etc.</li>
<li>CAN controller. Is a chip or internal unit of processor, which takes care of CAN (or NMEA2000) bus communication.</li>
<li>CAN transceiver (or just transceiver). “Level shifter” chip between CAN controller Tx/Rx and physical CAN bus CAN-H/CAN-L.</li>
<li>Termination resistor. 120 ohm resistor on both end of main CAN bus. <b>Do not forget these!</b></li>
</ul>
<h1><a class="anchor" id="secTRecHW"></a>
Recommended hardware</h1>
<p >I personally prefer to use Teensy 4.0, 4.1 (or 3.2, 3.5, 3.6 which are at end of life) or ESP32 board. Those boards have internal CAN controller and require only either isolated ISO1050 or unisolated MCP2562 transceiver for NMEA2000 connection. With default settings library requires roughly <b>about 30 kB rom and 4 kB RAM in normal operation</b>. So you should have <b>at least 8 kB RAM in your processor</b>. If you have Arduino Mega board, it is OK for testing and for small projects, but I do not prefer to buy one for new project. Arduino Due is better, but it is physically bigger and eats more power than Teensies or ESP32. If you have Arduino Uno or any board with less than 8 kB RAM, please read all library issues and Memory requirements on library ReadMe and then forget it. If you anyway want to use it and you have trouble to get it working, please do not set any issues.</p>
<h2><a class="anchor" id="subCANcontr"></a>
CAN controller</h2>
<p >Some boards (or processors) have internal CAN controller. In board there will be simply CAN Tx/CAN Rx pins, which often works with 3.3 V levels. Good examples of this kind of boards are recommended Teensy 4.0, 4.1 (or 3.2, 3.5, 3.6 which are at end of life) or ESP32 boards. Arduino DUE has also internal CAN controller. Never connect CAN Tx/CAN Rx pins directly to NMEA2000 bus. If you use board without internal CAN controller or you want to have second CAN controller e.g., for Teensy 3.2 or ESP32, you can use external one. Currently only supported is MCP2515. When you search “CAN bus shield” to buy, you have to take care of:</p>
<ul>
<li>Library supports only MCP2515 with either 16 MHz or 8 MHz clock. <b>16 MHz is preferred</b>.</li>
<li>Check SPI levels on your board. Most shields operate only with 5 V. If your board I/O is only 3.3 V tolerant, you should find shield with 3.3 V transceiver. MCP2551 or TJA1050 will not work.</li>
</ul>
<p >It is relatively easy to solder “CAN bus shield” by self. There is schematics in document ArduinoMega CAN with MCP2515 MCP2551.pdf. If you need to use that with 3.3 V processor, you can replace MCP2551 to MCP2562.</p>
<h2><a class="anchor" id="subCANtrans"></a>
CAN Transceiver</h2>
<p >CAN controller takes care of CAN (or NMEA2000) bus communication. To connect it to the bus, you need some CAN transceiver. The transceiver has two tasks. Receiving: it converts the data stream from CAN bus levels to levels that the CAN controller uses. It usually has protective circuitry to protect the CAN controller. Transmitting: it converts the data stream from the CAN controller to CAN bus levels.</p>
<h3><a class="anchor" id="subsubRecTra"></a>
Recommended transceiver</h3>
<p >I recommend either isolated ISO1050 or unisolated MCP2562 transceiver. ISO1050 has own power pin for both sides so it also works with any logic levels. MCP2562 operates with 5 V and it has own pin to define Tx/Rx logic levels for 3.3 V devices. There is lot of issues with SN65HVD230 transceiver. If you use that, please do not open issue – it is not library problem.</p>
<p >I do not know why there has been so much problems with SN65HVD230 - according datasheet it should be fine. I have had problems with MCP2562 only twice. Once I mixed Vdd and Vcc - worked fine after connected them right. Another time I connected STBY pin to Vdd, which puts chip to stand by.</p>
<dl class="section note"><dt>Note</dt><dd><b>This is very important.</b> <br  />
 If you use unisolated tranceiver like MCP2562, you may cause ground loop in your boat. Ground loops may generate other weird problems. You can read more about it e.g., from Ground loop in Wikipedia <a href="https://en.wikipedia.org/wiki/Ground_loop_(electricity)">https://en.wikipedia.org/wiki/Ground_loop_(electricity)</a>. <br  />
 If you e.g.,feed NMEA2000 bus on center of the boat and you have unisolated device, which also has ground by sensor on front of the boat, you have created ground loop. It may work without problems or may not. You may have communication errors etc.</dd></dl>
<h3><a class="anchor" id="subsubUnIso"></a>
Unisolated transceiver</h3>
<p >Unisolated tranceiver (like MCP2562) means that it will share the ground with NMEA2000 bus and with your board. You can use unisolated transceiver, if you power your device from NMEA2000 bus and it does not connect to ground from another path like through sensor.</p>
<ul>
<li>Devices with onboard temperature, humidity or atmospheric pressure sensors. E.g., device with 1-wire temperature sensor DS18S20 or DHT11 humidity sensor can be made with unisolated tranceiver.</li>
<li>Devices with other sensors like pressure using BMP280 via I<sup>2</sup>C, ultrasonic tank measurement, hall effect current, etc. particular care must be made so that the sensor does not connect to ground in any other than getting power from your board. <b>Even their bodies must be strictly isolate so that they cannot create a separate path to ground.</b></li>
<li>Devices reading bus and converting data to WiFi.</li>
<li>Devices with digital input or output as far you use isolation on I/O side. E.g., optoisolators for input and relays for output.</li>
</ul>
<p >In any case devices with unisolated tranceiver must be powered from NMEA2000 bus and they <b>can not be connected to unisolated sensors.</b> If you program unisolated device through USB connector with laptop, you are in safe when laptop is powered only by batteries. USB will connect your laptop ground to NMEA2000 bus ground, but since laptop is only battery powered, it is “floating” system. If you connect charger to your laptop same time, then it depends of charger do you have ground loop or not. Since this is just temporary connection, it should be OK.</p>
<h4><a class="anchor" id="autotoc_md127"></a>
Microchip MCP2562</h4>
<p >The MCP2561/2 is a high-speed CAN, fault-tolerant device that serves as the interface between a CAN protocol controller and the physical bus. The MCP2561/2 device provides differential transmit and receive capability for the CAN protocol controller, and is fully compatible with the ISO-11898-2 and ISO-11898-5 standards. It will operate at speeds of up to 1 Mb/s.</p>
<p >Typically, each node in a CAN system must have a device to convert the digital signals generated by a CAN controller to signals suitable for transmission over the bus cabling (differential output). It also provides a buffer between the CAN controller and the high-voltage spikes that can be generated on the CAN bus by outside sources (EMI, ESD, electrical transients, etc.).</p>
<div class="image">
<img src="MCP2562.png" alt=""/>
</div>
<p ><a href="http://ww1.microchip.com/downloads/en/devicedoc/20005167c.pdf">MCHP 2562 Datasheet</a></p>
<h3><a class="anchor" id="subsubIso"></a>
Isolated transceiver</h3>
<p >Isolated tranceiver has either optical or galvanic (ISO1050) isolation. Those has to be powered from both sides with isolated power, so you need also at least two power supplies. You must take care that both sides will also have always separate grounds and they do not touch in any way. Isolated device is safest solution in all cases.</p>
<h4><a class="anchor" id="autotoc_md128"></a>
TI ISO1050 Isolated CAN Transceiver</h4>
<p >The ISO1050 is a galvanically isolated CAN transceiver that meets the specifications of the ISO11898-2 standard. The device has the logic input and output buffers separated by a silicon oxide (SiO2) insulation barrier that provides galvanic isolation of up to 5000 VRMS for ISO1050DW and 2500 VRMS for ISO1050DUB. Used in conjunction with isolated power supplies, the device prevents noise currents on a data bus or other circuits from entering the local ground and interfering with or damaging sensitive circuitry. As a CAN transceiver, the device provides differential transmit capability to the bus and differential receive capability to a CAN controller at signaling rates up to 1 megabit per second (Mbps). The device is designed for operation in especially harsh environments, and it features cross-wire, overvoltage and loss of ground protection from –27 V to 40 V and overtemperature shutdown, as well as –12-V to 12-V common-mode range. The ISO1050 is characterized for operation over the ambient temperature range of –55°C to 105°C.</p>
<div class="image">
<img src="iso1050.png" alt=""/>
</div>
<p ><a href="https://www.ti.com/lit/ds/symlink/iso1050.pdf">ISO1050 Datasheet</a></p>
<h1><a class="anchor" id="secSchem"></a>
Schematics sample</h1>
<h2><a class="anchor" id="subFeedPwr"></a>
Feeding power from NMEA2000</h2>
<p >Note that development boards have been designed to be powered from USB. If you power your board from NMEA2000, you need to check how you can isolate USB power. All Teensy boards has “5V pad”, which you can cut. E.g., Teensy 3.2</p>
<div class="image">
<img src="teensy32_pinout.png" alt=""/>
</div>
<h2><a class="anchor" id="subTEunIso"></a>
Teensy 3.2, simple unisolated</h2>
<div class="image">
<img src="teensy32_uniso.png" alt=""/>
</div>
<p> I used this simple schematic at the beginning with 1-wire or other onboard or isolated sensors.</p>
<h2><a class="anchor" id="subTEiso"></a>
Teensy 3.2, simple isolated</h2>
<div class="image">
<img src="teensy32_iso.png" alt=""/>
</div>
<p> With isolated tranceiver you are safe to connect different sensors. You can e.g., measure engine temperature from engine by using resistor divider.</p>
<h2><a class="anchor" id="subTEperf"></a>
More protection for tranceiver</h2>
<p >Simple samples above did not have any protection to the bus. Unfortunately, power supplies etc. may cause your device to emit noise to the bus – or opposite. To have better protection, you can use something like this. </p><div class="image">
<img src="iso_trans.png" alt=""/>
</div>
<h2><a class="anchor" id="subFeedPwe"></a>
Feed isolated power from NMEA2000</h2>
<p >If your device does not require much power and you want to feed it totally from NMEA2000 bus, you can use something like this. </p><div class="image">
<img src="feed_pwr.png" alt=""/>
</div>
<p> Here Net-S is 12 V and GND-ISO is Gnd from NMEA2000 bus. You then feed your device from +5V/GND. Note that with this connection you do not have isolated 12 V for sensors. If you need that you have to use build your device with separated power supply as in chapter Teensy 3.2, simple isolated.</p>
<h1><a class="anchor" id="secTesting"></a>
Testing devices</h1>
<p >When your device hardware is ready and you have some other device to test it with, you can make simple test bench at home. Simply connect your device NMEA2000 CAN-H/CAN-L with another device. Note that if you use e.g., MFD as other device, that <b>needs to be powered on NMEA2000 connector</b> and also with external connector, if it has one. This is because MFD NMEA2000 tranceiver is isolated and powered from NMEA2000 bus. If you do not have MFD, but have several own devices use example DataDisplay2 on one device to listen bus. Add 120 ohm termination resistor to both end of your test bus. <b>The most common problem has been missing or wrong termination resistors!</b></p>
<div class="image">
<img src="can_wiring.png" alt=""/>
</div>
<p >Upload e.g., example TemperatureMonitor to your device and run it. It has been tested with Teensy, ESP32, Arduino DUE, Arduino Mega etc. When you run it, you should see it on your MFD device list or whatever your other device is. If you do not, check at least 10 times your connections, termination resistors, powering. Power off your system and measure that there is 60 ohm resistance between CAN-H and CAN-L. If everything is fine and you use some “CAN bus shield” with MCP2515, check the configuration on software for it is right. Library defaults 16 MHz clock and SPI CS pin 53. In 100% of cases problem has been in hardware or software configuration. When you have got it working, you can start to develop your own software.</p>
<h1><a class="anchor" id="secCommErr"></a>
Most common hardware errors</h1>
<p >If you test your device with e.g., example TemperatureMonitor, it should work. If it start to print “Sent failed” after a while, you will most probably have some hardware failure. “Sent failed” means that your device CAN controller can not send data to the bus. “Sent failed” message will come with delay, when send buffer has been filled up so it depends of your buffer size how long it will take.</p>
<ul>
<li>False or unconnected termination resistors. Measure that unpowered NMEA2000 bus has 60 ohm resistance between CAN-h and CAN-L.</li>
<li>CAN-L/CAN-H mixed</li>
<li>CAN Rx/Tx mixed.</li>
<li>Tranceiver broken</li>
<li>CAN controller broken</li>
<li>Invalid configuration settings for external CAN controller (MCP2515/mcp_can)</li>
<li>Invalid CAN Tx/Rx pins connected. (Teensy 3.5, 3.6, 4.0, 4.1)</li>
<li>Invalid CAN Tx/Rx pin definition e.g., with ESP32. Check that you used driver default pins, have proper definitions prior including driver or define pins on driver constructor.</li>
<li>Wrong logic levels on tranceiver or external CAN controller (CAN bus shield).</li>
<li>Isolated receiver like MFD NMEA2000 not powered.</li>
<li>Tranceiver set to disabled state.</li>
</ul>
<h1><a class="anchor" id="secNMEA2000bus"></a>
NMEA2000 bus</h1>
<p >NMEA_2000 bus is electrically CAN bus. NMEA2000 protocol is based on SAE_J1939, with specific messages for the marine environment. The one important thing differing from CAN is that bus speed is fixed to 250kb. On CAN bus it can be up to 1 Mb or even variable. If you are interested, dig more information from internet. NMEA2000 bus is like ethernet so that you can have multiple devices on same bus, they all can send information to the bus and there is no bus master device. The biggest difference to traditional NMEA0183 connection is that on NMEA0183 only one device can send data.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/NMEA_2000">NMEA_2000</a></li>
<li><a href="https://en.wikipedia.org/wiki/SAE_J1939">SAE_J1939</a></li>
</ul>
<h2><a class="anchor" id="subTopology"></a>
Bus topology</h2>
<p >In NMEA2000 bus there is one main bus called backbone or trunk. Devices to bus will be connected with drop cables. There are lot of good documents available. Look e.g. Proper NMEA 2000 Installation by NMEA organization, Complete guide to building an NMEA2000 network by Actisense, Network Installation guide by Maretron.</p>
<ul>
<li><a href="https://web.archive.org/web/20190602112104/https://www.nmea.org/Assets/2012%20ibex%20full%20%20nmea%20installation.pdf">2012 ibex full nmea installation.pdf&gt;</a></li>
<li><a href="https://actisense.com/complete-guide-to-building-an-nmea-2000-network/">complete-guide-to-building-an-nmea-2000-network</a></li>
<li><a href="https://www.maretron.com/products/pdf/Network%20Installation%20Guide.pdf">Network Installation Guide.pdf</a></li>
</ul>
<p >Important things are:</p>
<ul>
<li>You do not exceed maximum backbone length (100 m for light cable).</li>
<li>You have one 120 ohm termination resistor on each end of backbone. If you measure unpowered bus with ohm meter, you should measure 60 ohm resistance between CAN-H and CAN-L.</li>
<li>You do not exceed maximum drop cable length, which is 6 m. E.g. in sailing boats, if your bus will go to top of the mast, you have to have that as backbone and so have termination resistor at top of the mast.</li>
<li>You power bus from exactly one point. This also means that your bus ground wire must be connected ground only on that point to avoid ground loops.</li>
</ul>
<h2><a class="anchor" id="subConnetor"></a>
Bus connectors</h2>
<p >If you need just one or two cable, it may be easiest to buy it from marine dealer, but if you start to build whole NMEA2000 network, you may save a lot by using industry standard parts. NMEA2000 bus uses same cabling as DeviceNet, which is used in industry. So you can build your NMEA2000 network with DeviceNet cables and connectors.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/DeviceNet">DeviceNet</a></li>
</ul>
<p >The most common connector used in NMEA2000 is M12 5-pin Micro-C connector.</p>
<table style="border: none">
<tr>
<td><div class="image">
<img src="microC_male.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="microC_female.png" alt=""/>
</div>
 </td></tr>
<tr>
<td><div class="image">
<img src="conn1.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="conn2.png" alt=""/>
</div>
 </td></tr>
</table>
<p >By searching from internet with ”M12 5-pin Micro-C connector” you will find lot of alternatives cheaper that from local marine dealer. In pictures above are connectors with screw terminals and easy to install. To get smaller sizes you can use connectors with solder terminals.</p>
<dl class="section note"><dt>Note</dt><dd>If you search connector with fixed cable, take care that you select it with DeviceNet colouring.</dd></dl>
<p>You can search also “DeviceNet connector” and you will find commonly used connector: </p><div class="image">
<img src="conn3.png" alt=""/>
</div>
<p> With above model it is easy to make e.g., hub-box instead of using expensive Micro-C hubs.</p>
<h2><a class="anchor" id="subCable"></a>
Bus cables</h2>
<p >In fixed cabling I have used DeviceNet PUR L45467-F16-W8 (1 x 2 x 0,67 mm2 + 1 x 2 x 0,38 mm2). I have used this because it happens to be my cable dealer type. Just google “DeviceNet cable” to find alternatives. You can use other types of cables, but to make life easier using NMEA2000 or DeviceNet cable you have right pairing, proper shielding and colours: + = red, - = Gnd, CAN-H = white, CAN-L = blue, and shield.</p>
<table style="border: none">
<tr>
<td><div class="image">
<img src="cable.png" alt=""/>
</div>
 </td><td><div class="image">
<img src="cross_cable.png" alt=""/>
</div>
 </td></tr>
</table>
<h2><a class="anchor" id="secFailure"></a>
Prepare for failures</h2>
<p >If you had problem on old NMEA0183 connection, only one device went off. With NMEA2000 there is risk that one failing device will lock the whole bus and all your devices will be then off. Simple preparing may safe you from full disaster.</p>
<ul>
<li>Make drawing of your NMEA2000 bus connections.</li>
<li>Make layout drawing of your boat about all NMEA2000 bus connection points so that you can easily locate them. Mark also power feed place.</li>
<li>Make simple wire with bus connector, which you can use to check bus voltage with volt meter at any connection point.</li>
<li>Prepare with 1-2 extra termination resistor pieces.</li>
<li>Make plan, which order you unplug devices from bus in case of failure.</li>
</ul>
<p >In case you have problems on the bus and it is not clear, simply take drawings and:</p>
<ul>
<li>Unplug device from some connection point.</li>
<li>If it does not help, unplug rest of backbone at that point and replace with termination resistor.</li>
<li>If it does not help, measure voltage on that point.</li>
<li>If voltage is ok, leave this unconnected and try other connection point. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
